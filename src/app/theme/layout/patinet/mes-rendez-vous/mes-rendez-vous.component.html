<div class="calendar-container">
  <full-calendar [options]="calendarOptions"></full-calendar>

  <div class="modal-backdrop" *ngIf="showModal">
    <div class="modal-box glass">
      <div class="modal-header">
        <div class="modal-icon">
          <i class="fa fa-calendar-check"></i>
        </div>
        <div>
          <h2>{{ modalMode === 'view' ? 'Détails du rendez-vous' : 'Nouveau rendez-vous' }}</h2>
          <p class="subtitle">Clinique médicale</p>
        </div>
      </div>

      <div class="modal-body">
        <ng-container *ngIf="modalMode === 'view'">
          <div class="info-row">
            <span>Docteur</span>
            <strong>{{ selectedEvent?.doctor }}</strong>
          </div>
          <div class="info-row">
            <span>Date</span>
            <strong>{{ selectedEvent?.date | date:'fullDate' }}</strong>
          </div>
          <div class="info-row">
            <span>Heure</span>
            <strong>{{ selectedEvent?.time }}</strong>
          </div>
          <div class="info-card">
            <h4>Motif</h4>
            <p>{{ selectedEvent?.remark }}</p>
          </div>
        </ng-container>

        <ng-container *ngIf="modalMode === 'add'">
          <div class="form-group">
            <label>Docteur</label>
            <select [(ngModel)]="newAppointment.doctor" (change)="checkAvailability()">
              <option value="">Choisir un docteur</option>
              <option *ngFor="let d of doctors" [value]="d">{{ d }}</option>
            </select>
          </div>

          <div class="form-group time-group">
            <label>Heure</label>
            <select [(ngModel)]="newAppointment.time" (change)="checkAvailability()">
              <option value="">Choisir un créneau</option>
              <option *ngFor="let t of getAvailableTimes()" [value]="t">{{ t }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Motif</label>
            <textarea rows="3" [(ngModel)]="newAppointment.remark"></textarea>
          </div>

          <div class="availability-error" *ngIf="conflict">
            Ce créneau est déjà réservé
          </div>
        </ng-container>
      </div>

      <div class="modal-footer">
        <button class="btn ghost" (click)="closeModal()">Fermer</button>
        <button
          *ngIf="modalMode === 'add'"
          class="btn primary"
          [disabled]="conflict || !newAppointment.doctor || !newAppointment.time"
          (click)="confirmAdd()">
          Confirmer
        </button>
        <button
          *ngIf="modalMode === 'view'"
          class="btn danger"
          (click)="cancelAppointment()">
          Annuler RDV
        </button>
      </div>
    </div>
  </div>
</div>
